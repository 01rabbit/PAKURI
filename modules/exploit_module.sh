function passcrack_menu()
{
    local ans

    box_1 "Password Crack"
    echo -e "------------------- Select Action --------------------"
    select_2 "Single" "Multi"
    read -n 1 -s ans
    if [ $ans = 1 ];then
        clear
        exploit_banner
        date
        echo -e "------------------- Exploit Menu --------------------"
        box_1 "Password Crack"
        echo -e "------------------- Select Action --------------------"
        box_1 "Single"
        read -p "IP Address :" addr
        echo -e "Start Password Cracking. Single Host"            
        use_brutespray $addr S
        tmux select-pane -t $WINDOW_NAME.0
        echo -e "Press any key to continue..."
        read
    elif [ $ans = 2 ];then
        clear
        exploit_banner
        date
        echo -e "------------------- Exploit Menu --------------------"
        box_1 "Password Crack"
        echo -e "------------------- Select Action --------------------"
        box_2 "Multi"
        echo -e "Start Password Cracking. Multi Host"             
        use_brutespray $SCRIPT_DIR/$TARGETS M
        tmux select-pane -t $WINDOW_NAME.0
        echo -e "Press any key to continue..."
        read
    fi
}

function use_brutespray()
{
    cd $WDIR
    if [[ ! -d $WDIR/brutespray ]]; then
	mkdir $WDIR/brutespray
    fi

    rm $WDIR/brutespray/*

    BRUTE="$WDIR/brutespray/brute"
    if [ $2 = "S" ];then
        tmux send-keys -t $WINDOW_NAME.1 "nmap -T4 -p- --max-retries 1 --max-scan-delay 20 --defeat-rst-ratelimit --open -oX $BRUTE-$1.xml $1;brutespray --file $BRUTE-$1.xml --output $WDIR/brutespray/;rm $BRUTE-$1.xml;cat $WDIR/brutespray/*" C-m
    elif [ $2 = "M" ];then
        tmux send-keys -t $WINDOW_NAME.1 "nmap -T4 -p- --max-retries 1 --max-scan-delay 20 --defeat-rst-ratelimit --open -oX $BRUTE-multi.xml -iL $1;brutespray --file $BRUTE-multi.xml --output $WDIR/brutespray/ --threads 5 --hosts 5;rm $BRUTE-multi.xml;cat $WDIR/brutespray/*" C-m
    fi
}

function metasploit_menu()
{
    local key
    local ans

    box_2 "Metasploit"
    echo -e "------------------- Metasploit Menu --------------------"
    select_4 "Setup" "Import to msf databas" "Check the hosts (msf db)" "Check the services (msf db)"
    read -n 1 -s key
    clear
    exploit_banner
    date
    echo -e "------------------- Exploit Menu --------------------"
    box_2 "Metasploit"
    echo -e "------------------- Metasploit Menu --------------------"
    case $key in
        1 )
            clear
            exploit_banner
            date
            echo -e "------------------- Exploit Menu --------------------"
            box_2 "Metasploit"
            echo -e "------------------- Metasploit Menu --------------------"
            box_1 "Setup"
            echo -e "------------------- Select Action --------------------"
            select_4 "Create and initialize the msf database" "Delete msf database" "Start Matasploit" "Stop Matasploit"
            read -n 1 -s ans
            clear
            exploit_banner
            date
            echo -e "------------------- Exploit Menu --------------------"
            box_2 "Metasploit"
            echo -e "------------------- Metasploit Menu --------------------"
            box_1 "Setup"
            echo -e "------------------- Select Action --------------------"
            if [ $ans = 1 ];then
                box_1 "Create and initialize the msf database"
                tmux send-keys -t $WINDOW_NAME.1 'msfdb init' C-m
                echo -e "Press any key to continue..."
                read
            elif [ $ans = 2 ];then
                box_2 "Delete msf database"
                echo -e "Do you really want to delete?"
                yes-no
                read -n 1 -s ans
                if [ $ans -eq 1 ];then
                    tmux send-keys -t $WINDOW_NAME.1 'msfdb delete' C-m
                    echo -e "Press any key to continue..."
                    read
                fi
            elif [ $ans = 3 ];then
                box_3 "Start Matasploit"
                tmux send-keys -t $WINDOW_NAME.1 'msfconsole' C-m
                sleep 20
                echo -e "Press any key to continue..."
                read
            elif [ $ans = 4 ];then
                box_4 "Stop Matasploit"
                echo -e "Running Metasploit termination processing..."
                tmux send-keys -t $WINDOW_NAME.1 'exit -y' C-m
                sleep 2
                if [ `tmux list-panes|wc -l` = 1 ];then
                    tmux split-window -t $SESSION_NAME.0 -h
                    tmux select-pane -t $SESSION_NAME.0
                else
                    tmux send-keys -t $WINDOW_NAME.1 'clear' C-m
                fi 
            fi ;;
        2 )
            box_2 "Import to msf databas"
            for i in `find $WDIR -path "$1/*.xml"`
            do
                tmux send-keys -t $WINDOW_NAME.1 "db_import $i" C-m
            done
            echo -e "Press any key to continue..."
            read ;;
        3 )
            box_3 "Check the hosts (msf db)"
            tmux send-keys -t $WINDOW_NAME.1 'hosts' C-m
            echo -e "Press any key to continue..."
            read ;;
        4 )
            box_4 "Check the services (msf db)"
            tmux send-keys -t $WINDOW_NAME.1 'services' C-m
            echo -e "Press any key to continue..."
            read ;;
        9 )
            break ;;
    esac
}
function exploit_manage()
{
    local key
    local ans
    local flg_pc
    
    while :
    do
        clear
        exploit_banner
        date
        echo -e "------------------- Exploit Menu --------------------"
        if ps -ef|grep brutespray|grep -v "grep" >/dev/null;then
            select_3 "Password Crack ${RED} Running" "Metasploit" "Assist"
            flg_pc=1
        else
            select_3 "Password Crack" "Metasploit" "Assist"
            flg_pc=0
        fi
        read -n 1 -t 5 -s key
        clear
        exploit_banner
        date
        echo -e "------------------- Exploit Menu --------------------"
        case "$key" in
            1 )
                if [ $flg_pc = "1" ];then
                    echo -e "Password Crack process is Running!"
                    echo -e "Press any key to continue..."
                    read
                    break
                else
                    passcrack_menu
                fi ;;
            2 )
                metasploit_menu ;;
            3 )
                tmux send-keys -t $WINDOW_NAME.1 "clear && cat $DOCUMENTS/assist_exploit.txt" C-m 
                tmux select-pane -t $WINDOW_NAME.0 ;;
            9 )
                tmux send-keys -t $WINDOW_NAME.1 'exit -y' C-m
                sleep 2
                if [ `tmux list-panes|wc -l` = 1 ];then
                    tmux split-window -t $SESSION_NAME.0 -h
                    tmux select-pane -t $SESSION_NAME.0
                else
                    tmux send-keys -t $WINDOW_NAME.1 'clear' C-m
                fi 
                break ;;
            * )
                echo "error" ;;
        esac
    done
}
